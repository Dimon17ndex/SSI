<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Расписание</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background-color: #f0f0f0; display: flex; flex-direction: column; align-items: center; padding-bottom: 50px; }
        .header { display: flex; justify-content: space-between; align-items: center; padding: 15px 25px; background: white; width: 100%; box-sizing: border-box; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .day-name { font-size: 1.5rem; font-weight: bold; color: #2c3e50; }
        #currentTime { background: white; padding: 10px 30px; border-radius: 15px; margin: 20px 0; box-shadow: 0 4px 10px rgba(0,0,0,0.05); text-align: center; }
        .time-value { font-size: 3rem; font-weight: bold; color: #333; }
        .btn-group { display: flex; gap: 10px; margin-bottom: 20px; }
        .btn { padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .btn-set { background: #3498db; color: white; }
        .btn-reset { background: #e74c3c; color: white; }

        .class-row { width: 90%; max-width: 600px; margin-bottom: 15px; }
        .class-table { width: 100%; border-collapse: collapse; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .class-table th { background: #2c3e50; color: white; padding: 12px; transition: 0.3s; }
        .class-table td { padding: 20px; text-align: center; font-size: 1.2rem; font-weight: 500; border: 1px solid #eee; position: relative; height: 80px; }

        .weekend-badge { display: inline-block; background-color: #27ae60; color: white; padding: 8px 20px; border-radius: 10px; font-weight: bold; text-transform: uppercase; }
        .standby-mode th { background-color: #444 !important; }
        .inner-red-timer { color: #e74c3c; font-weight: bold; margin-top: 5px; font-size: 1rem; display: none; }
        .inner-red-timer.show { display: block; }

        .timer-container { display: none; background: #222; color: white; width: 100%; margin-top: 5px; border-radius: 10px; padding: 10px; box-sizing: border-box; text-align: center; }
        .timer-container.visible { display: block; }
        .timer-val { font-size: 1.5rem; font-weight: bold; color: #2ecc71; }

        #timeDialog { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 25px; border-radius: 15px; z-index: 2000; box-shadow: 0 0 50px rgba(0,0,0,0.5); width: 280px; }
        .modal-input { width: 100%; padding: 10px; margin: 10px 0 15px 0; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
    </style>
</head>
<body>

    <div class="header">
        <div class="date-block">
            <div id="dayName" class="day-name">---</div>
            <div id="fullDate" style="color: #7f8c8d;">---</div>
        </div>
        <div id="currentYear">2026</div>
    </div>

    <div id="currentTime">
        <div id="timeValue" class="time-value">00:00:00</div>
    </div>

    <div class="btn-group">
        <button class="btn btn-set" onclick="openDialog()">ТЕСТ</button>
        <button class="btn btn-reset" onclick="resetTime()">СБРОС</button>
    </div>

    <div class="class-row">
        <table class="class-table" id="table-1ab">
            <thead><tr><th>1-А/Б КЛАСС</th></tr></thead>
            <tbody><tr><td><div id="slot-1ab">---</div><div id="red-1ab" class="inner-red-timer">00:00</div></td></tr></tbody>
        </table>
        <div id="cont-1ab" class="timer-container">
            <div style="font-size: 0.7rem;">ДО НАЧАЛА (07:00):</div>
            <div id="val-1ab" class="timer-val">-- мин</div>
        </div>
    </div>

    <div class="class-row">
        <table class="class-table" id="table-11b">
            <thead><tr><th>11-Б КЛАСС</th></tr></thead>
            <tbody><tr><td><div id="slot-11b">---</div><div id="red-11b" class="inner-red-timer">00:00</div></td></tr></tbody>
        </table>
        <div id="cont-11b" class="timer-container">
            <div style="font-size: 0.7rem;">ДО НАЧАЛА (07:00):</div>
            <div id="val-11b" class="timer-val">-- мин</div>
        </div>
    </div>

    <div id="timeDialog">
        <h3 style="margin-top:0">Настройки теста</h3>
        <label>Дата:</label><input type="date" id="testDate" class="modal-input">
        <label>Время:</label><input type="time" id="testTime" class="modal-input">
        <button class="btn btn-set" style="width:100%" onclick="applyTest()">ОК</button>
        <button class="btn" style="width:100%; margin-top:5px" onclick="closeDialog()">ОТМЕНА</button>
    </div>

    <script>
        let simulatedNow = null;

        const sch1ab = [
            {n:'Урок №1', s:'08:00', e:'08:35'}, {n:'Перемена', s:'08:35', e:'08:55'},
            {n:'Урок №2', s:'08:55', e:'09:30'}, {n:'Перемена', s:'09:30', e:'09:40'},
            {n:'Урок №3', s:'09:40', e:'10:15'}, {n:'Перемена', s:'10:15', e:'10:45'}
        ];

        const sch11b = [
            {n:'Урок №1', s:'08:00', e:'08:35'}, {n:'Перемена', s:'08:35', e:'08:45'},
            {n:'Урок №2', s:'08:45', e:'09:20'}, {n:'Перемена', s:'09:20', e:'09:35'}
        ];

        function toSec(t) { const [h, m] = t.split(':').map(Number); return h * 3600 + m * 60; }

        function update() {
            const now = simulatedNow ? new Date(simulatedNow) : new Date();
            const day = now.getDay(); 
            const sec = now.getHours() * 3600 + now.getMinutes() * 60 + now.getSeconds();

            document.getElementById('timeValue').textContent = now.toLocaleTimeString('ru-RU');
            document.getElementById('dayName').textContent = ['Воскресенье','Понедельник','Вторник','Среда','Четверг','Пятница','Суббота'][day];
            document.getElementById('fullDate').textContent = now.toLocaleDateString('ru-RU', {day:'numeric', month:'long'});

            const t_prep = toSec('06:56');
            const t_active = toSec('07:00');

            // 1. ВЫХОДНЫЕ
            if (day === 0 || day === 6) {
                renderState('1ab', 'WEEKEND');
                renderState('11b', 'WEEKEND');
                return;
            }

            // 2. БУДНИ
            handleClass('1ab', sch1ab, sec, t_prep, t_active);
            handleClass('11b', sch11b, sec, t_prep, t_active);
        }

        function handleClass(id, sch, sec, t_prep, t_active) {
            if (sec < t_prep) {
                renderState(id, 'WAIT_CONNECT');
            } else if (sec < t_active) {
                renderState(id, 'PREPARE', t_active - sec);
            } else {
                let current = sch.find(u => sec >= toSec(u.s) && sec < toSec(u.e));
                if (current) {
                    renderState(id, 'LESSON', toSec(current.e) - sec, current.n);
                } else {
                    renderState(id, 'IDLE');
                }
            }
        }

        function renderState(id, state, timeLeft, label) {
            const slot = document.getElementById('slot-'+id);
            const table = document.getElementById('table-'+id);
            const red = document.getElementById('red-'+id);
            const cont = document.getElementById('cont-'+id);
            const val = document.getElementById('val-'+id);

            table.classList.remove('standby-mode');
            red.classList.remove('show');
            cont.classList.remove('visible');

            if (state === 'WEEKEND') {
                slot.innerHTML = '<div class="weekend-badge">Выходной день</div>';
                table.classList.add('standby-mode');
            } else if (state === 'WAIT_CONNECT') {
                slot.textContent = 'ОЖИДАНИЕ СВЯЗИ';
                table.classList.add('standby-mode');
            } else if (state === 'PREPARE') {
                slot.textContent = 'ПОДГОТОВКА...';
                cont.classList.add('visible');
                val.textContent = Math.ceil(timeLeft / 60) + ' мин';
            } else if (state === 'LESSON') {
                slot.textContent = label.toUpperCase();
                red.classList.add('show');
                red.textContent = Math.floor(timeLeft/60) + ':' + String(timeLeft%60).padStart(2,'0');
            } else {
                slot.textContent = 'ОЖИДАНИЕ';
                table.classList.add('standby-mode');
            }
        }

        function openDialog() { document.getElementById('timeDialog').style.display = 'block'; }
        function closeDialog() { document.getElementById('timeDialog').style.display = 'none'; }
        function applyTest() {
            const d = document.getElementById('testDate').value;
            const t = document.getElementById('testTime').value;
            if(d && t) { simulatedNow = new Date(d + 'T' + t); update(); closeDialog(); }
        }
        function resetTime() { simulatedNow = null; update(); }

        setInterval(() => { if(simulatedNow) simulatedNow = new Date(simulatedNow.getTime()+1000); update(); }, 1000);
        update();
    </script>
</body>
</html>
